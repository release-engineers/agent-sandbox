FROM ubuntu:22.04

ENV TZ="Europe/Amsterdam"

RUN apt update

RUN apt install -y \
    less \
    git \
    procps \
    sudo \
    fzf \
    zsh \
    unzip \
    gh \
    curl \
    wget \
    vim \
    jq \
    golang-go \
    ca-certificates \
    gnupg \
    lsb-release \
    python3.10-venv

# Install Node.js 20 (includes npm)
RUN curl -fsSL https://deb.nodesource.com/setup_20.x | bash - && apt-get install -y nodejs && \
    npm --version

# Set environment variables
ENV NODE_OPTIONS="--max-old-space-size=4096"
ENV CLAUDE_CONFIG_DIR="/root/.claude"

# Create workspace and config directories
RUN mkdir -p /workspace /root/.claude /hooks /var/log && \
    chmod 777 /var/log

# Copy hook scripts
COPY hooks/ /hooks/

# Setup certificate handling for proxy
RUN mkdir -p /usr/local/share/ca-certificates

# Copy pre-generated proxy certificate
COPY certs/proxy.crt /usr/local/share/ca-certificates/proxy.crt

# Update CA certificates to include proxy certificate
RUN update-ca-certificates

# Install Claude Code CLI
RUN npm install -g @anthropic-ai/claude-code

WORKDIR /workspace

# Let Claude Code know it's a sandbox and running as root is OK
ENV IS_SANDBOX=1

# Default to bash shell for interactive use
CMD ["/bin/bash"]
